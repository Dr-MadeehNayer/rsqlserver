Benchmarking
========================================================

In order to convince people to use the package, 
I Compare rsqlserver performance with other packges.

* RJDBC
* RODBC


```{r globaloptions,ech=FALSE}

opts_chunk$set(warning=FALSE)

```

The code to connect from differnt drivers is :
```{r connections}
library(RODBC)

conn.rodbc <- function()
  {
  odbcConnect(dsn = "my-dns", uid = "collateral", pwd = "collat")
  }
library(rsqlserver)
conn.rsqlserver <- function(){
  dbConnect('SqlServer',user="collateral",password="collat",
            host="localhost",trusted=TRUE, timeout=30)
  }

```

Here we present 3  methods to get the results:
* Using sqlQuery from RODBC package 
* Using dbGetQuery from rsqlserver package
* Using fetch from rsqlserver package, giving the number of lines to read.

```{r query}

nrows <- 1000000

Query <- paste0("SELECT TOP ", format(nrows, scientific=F), " * 
                 FROM T_BIG_1000000")


get.rodbc <- function (conn,query=Query){
  res <- sqlQuery(conn, query)
  res
  }

get.rsqlserver1 <- function(conn,query=Query){
  res <- dbGetQuery(conn, query)
  res
}

get.rsqlserver2 <- function(conn,query=Query,n=nrows){
  reader <- dbSendQuery(conn, query)
  res <- fetch(reader,n)
  invisible(dbClearResult(reader))
  res
}


```

```{r benchamrking}

library(microbenchmark)
microbenchmark(conn1<- conn.rodbc(),conn2 <- conn.rsqlserver(),times=1)

microbenchmark(get.rodbc(conn1),
               get.rsqlserver1(conn2),
               get.rsqlserver2(conn2) ,times=10)

dbDisconnect(conn2)

```
